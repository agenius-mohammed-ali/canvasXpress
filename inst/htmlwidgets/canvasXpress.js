HTMLWidgets.widget({
    name : "canvasXpress",
    type : "output",

    factory: function(el, width, height) {
        var c = document.createElement('canvas');
        c.id = el.id + '-cx';
        c.width = width;
        c.height = height;

        el.appendChild(c);

        return {
            id: c.id,
            svg: "",
            renderValue: function(x) {
                try{CanvasXpress.destroy(c.id);}
                catch(err) {/*do nothing*/}
                if (!(x instanceof Array)) {
                    x.renderTo = c.id;
                    cx = new CanvasXpress(x);
                    if (x.config.test) {
                        console.log(this);
                        console.log(cx);
                        this.svg = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="570" height="570"><defs><clipPath id="FnDvGPdCfttH"><path fill="none" stroke="none" d=" M 35.972265625 41.599999999999994 L 434.31542968749994 41.599999999999994 L 434.31542968749994 501.1451171875 L 35.972265625 501.1451171875 L 35.972265625 41.599999999999994 Z"/></clipPath></defs><g><g transform="translate(285,285)"><rect fill="rgb(255,255,255)" stroke="none" x="-285" y="-285" width="570" height="570"/><g transform="translate(-285,-285)"/></g><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 501.5 L 434.5 501.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 484.5 L 434.5 484.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 466.5 L 434.5 466.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 448.5 L 434.5 448.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 431.5 L 434.5 431.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 413.5 L 434.5 413.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 396.5 L 434.5 396.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 378.5 L 434.5 378.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 360.5 L 434.5 360.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 343.5 L 434.5 343.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 325.5 L 434.5 325.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 307.5 L 434.5 307.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 290.5 L 434.5 290.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 272.5 L 434.5 272.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 255.5 L 434.5 255.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 237.5 L 434.5 237.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 219.5 L 434.5 219.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 202.5 L 434.5 202.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 184.5 L 434.5 184.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 167.5 L 434.5 167.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 149.5 L 434.5 149.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 131.5 L 434.5 131.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 114.5 L 434.5 114.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 96.5 L 434.5 96.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 79.5 L 434.5 79.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 61.5 L 434.5 61.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 43.5 L 434.5 43.5" stroke-miterlimit="10" stroke-width="0.3333333333333333"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 501.5 L 434.5 501.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 33.5 501.5 L 36.5 501.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 434.5 501.5 L 438.5 501.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 413.5 L 434.5 413.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 33.5 413.5 L 36.5 413.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 434.5 413.5 L 438.5 413.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 325.5 L 434.5 325.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 33.5 325.5 L 36.5 325.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 434.5 325.5 L 438.5 325.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 237.5 L 434.5 237.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 33.5 237.5 L 36.5 237.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 434.5 237.5 L 438.5 237.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 149.5 L 434.5 149.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 33.5 149.5 L 36.5 149.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 434.5 149.5 L 438.5 149.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 36.5 61.5 L 434.5 61.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 33.5 61.5 L 36.5 61.5" stroke-miterlimit="10"/><path fill="none" stroke="rgb(204,204,204)" paint-order="fill stroke markers" d=" M 434.5 61.5 L 438.5 61.5" stroke-miterlimit="10"/><g clip-path="url(#FnDvGPdCfttH)"><g><g transform="translate(102.36226562499999,474.7344782686781)"><rect fill="rgb(254,41,108)" stroke="none" x="-32.195" y="-26.41063891882184" width="64.39" height="52.82127783764368"/><rect fill="none" stroke="rgb(0,0,0)" x="-32.195" y="-26.41063891882184" width="64.39" height="52.82127783764368" stroke-linejoin="mitter" stroke-miterlimit="10"/><g transform="translate(-102.36226562499999,-474.7344782686781)"/></g><g transform="translate(235.142265625,377.8954688996647)"><rect fill="rgb(254,41,108)" stroke="none" x="-32.195" y="-123.24964828783524" width="64.39" height="246.49929657567048"/><rect fill="none" stroke="rgb(0,0,0)" x="-32.195" y="-123.24964828783524" width="64.39" height="246.49929657567048" stroke-linejoin="mitter" stroke-miterlimit="10"/><g transform="translate(-235.142265625,-377.8954688996647)"/></g><g transform="translate(367.92226562499997,281.0564595306513)"><rect fill="rgb(254,41,108)" stroke="none" x="-32.195" y="-220.08865765684865" width="64.39" height="440.1773153136973"/><rect fill="none" stroke="rgb(0,0,0)" x="-32.195" y="-220.08865765684865" width="64.39" height="440.1773153136973" stroke-linejoin="mitter" stroke-miterlimit="10"/><g transform="translate(-367.92226562499997,-281.0564595306513)"/></g></g></g><g transform="translate(29.172265624999998,501.1451171875)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="end" dominant-baseline="central">30</text></g><g transform="translate(29.172265624999998,413.10965412476054)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="end" dominant-baseline="central">35</text></g><g transform="translate(29.172265624999998,325.0741910620211)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="end" dominant-baseline="central">40</text></g><g transform="translate(29.172265624999998,237.0387279992816)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="end" dominant-baseline="central">45</text></g><g transform="translate(29.172265624999998,149.00326493654217)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="end" dominant-baseline="central">50</text></g><g transform="translate(29.172265624999998,60.96780187380267)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="end" dominant-baseline="central">55</text></g><g transform="translate(441.11542968749995,501.1451171875)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="start" dominant-baseline="central">30</text></g><g transform="translate(441.11542968749995,413.10965412476054)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="start" dominant-baseline="central">35</text></g><g transform="translate(441.11542968749995,325.0741910620211)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="start" dominant-baseline="central">40</text></g><g transform="translate(441.11542968749995,237.0387279992816)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="start" dominant-baseline="central">45</text></g><g transform="translate(441.11542968749995,149.00326493654217)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="start" dominant-baseline="central">50</text></g><g transform="translate(441.11542968749995,60.96780187380267)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="start" dominant-baseline="central">55</text></g><g transform="translate(102.36226562499999,502.84511718749997) rotate(-90,0,0)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="end" dominant-baseline="central">Sample1</text></g><g transform="translate(235.142265625,502.84511718749997) rotate(-90,0,0)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="end" dominant-baseline="central">Sample2</text></g><g transform="translate(367.922265625,502.84511718749997) rotate(-90,0,0)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="end" dominant-baseline="central">Sample3</text></g><g transform="translate(515,271)"><rect fill="rgb(255,255,255)" stroke="none" x="-48" y="-12" width="96" height="24"/><g transform="translate(-515,-271)"/></g><g transform="translate(477.28769531249986,269.57255859375)"><rect fill="rgb(254,41,108)" stroke="none" x="-7" y="-7" width="14" height="14"/><rect fill="none" stroke="rgb(0,0,0)" x="-7" y="-7" width="14" height="14" stroke-linejoin="mitter" stroke-miterlimit="10"/><g transform="translate(-477.28769531249986,-269.57255859375)"/></g><g transform="translate(498.28769531249986,269.57255859375)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="14px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="start" dominant-baseline="central">Variable1</text></g><g transform="translate(515,271)"><rect fill="none" stroke="rgb(204,204,204)" x="-48" y="-12" width="96" height="24" stroke-linejoin="mitter" stroke-miterlimit="10"/><g transform="translate(-515,-271)"/></g><g transform="translate(285,17.4)"><text fill="rgb(0,0,0)" stroke="none" font-family="Arial" font-size="28px" font-style="normal" font-weight="normal" text-decoration="normal" x="0" y="0" text-anchor="middle" dominant-baseline="central">Simple Bar graph</text></g></g></svg>';
                    }
                    cx;
                }
            },
            resize: function(width, height) {
                cx = CanvasXpress.getObject(c.id);
                if (cx) {
                    cx.setDimensions(width, height);
                }
            }
        };
    }
});
